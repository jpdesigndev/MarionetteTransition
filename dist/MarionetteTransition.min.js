!function(a,b){"function"==typeof define&&define.amd?define([],function(c,d,e,f,g){return a.returnExportsGlobal=b(c,d,e,f,g)}):"object"==typeof exports?module.exports=b():a.MarionetteTransition=b()}(this,function(a,b,c,d,e){var f=function(a){return function(b,c,d){return a.to(b,d.duration,{x:c,opacity:d.opacity||"1",paused:d.paused||!0})}}(d,e),g=function(a,b,c,d,e,f){var g=c.Region.extend({initialize:function(){this.setup()},setup:function(){this.viewStack=[],this.currentViewIndex=-1,this.listenToOnce(this,"show",this.onFirstShow)},onFirstShow:function(){this.$el.addClass("mt-region")},show:function(){var a=1<=arguments.length?[].slice.call(arguments,0):[],c=a[0];return this.listenTo(c,"show",function(){b.defer(b.bind(function(){this._resetViews(c),this._triggerViewEvent(c,"transition:end"),this._triggerViewEvent(c,"transition:end:in")},this))}),this._show.apply(this,a),this._cleanUpOldViews(),this},close:function(){var a=1<=arguments.length?[].slice.call(arguments,0):[];return this._close.apply(this,a),this._cleanUpOldViews(),this},showTransition:function(c,d){var e=this.setupTransitionOptions(d),f=this.currentView;if(!e.transtionWhenEmpty&&!f)return this.show(c,e),this;if(c===f)return this.showSame(c,d),this;this.ensureEl();var g=c.isClosed||b.isUndefined(c.$el),h=c!==this.currentView;return this.preventClose=!!e.preventClose,c.render(),this._triggerViewEvent(c,"before:show"),(h||g)&&(this.addViewToDom(c),this._triggerRepaint()),this.prepareRegion(c,f,e),a.when(this.transition(c,f,e)).then(b.bind(function(){this._cleanUpOldViews(),this._resetViews(c)},this)),this._triggerViewEvent(c,"show"),this},closeTransition:function(d){function e(){this._cleanUpOldViews(),c.triggerMethod.call(this,"close"),this.setup(),delete this.currentView}var f=this.currentView,g=this.setupTransitionOptions(d);f&&!f.isClosed&&(this.prepareCommonOptions(g),this.prepareOldView(f,g),a.when(this.transition(null,f,g)).then(b.bind(e,this)))},hideTransition:function(b){var c=this.currentView,d=this.setupTransitionOptions(b);c&&!c.isClosed&&(this.preventClose=!0,this.prepareCommonOptions(d),this.prepareOldView(c,d),a.when(this.transition(null,c,d)))},push:function(b,c){this.ensureEl();var d=this.setupTransitionOptions(c);d.push=!0,this.preventClose=!0;var e=this.currentView;return b.render(),this._triggerViewEvent(b,"before:show"),this._triggerViewEvent(b,"before:push"),this.addViewToDom(b),this._triggerRepaint(),this.prepareRegion(b,e,d),a.when(this.transition(b,e,d)),this._triggerViewEvent(b,"show"),this._triggerViewEvent(b,"push"),this.addView(b),this},pop:function(b){if(this.currentViewIndex<=0||this.viewStack.length<=1)return this;this.ensureEl();var c=this.setupTransitionOptions(b);c.pop=!0,this.preventClose=!1;var d=this.currentView,e=this.viewStack[this.currentViewIndex-1];return this._triggerViewEvent(e,"before:show"),this._triggerViewEvent(e,"before:pop"),this.prepareRegion(e,d,c),a.when(this.transition(e,d,c)),this._triggerViewEvent(e,"show"),this._triggerViewEvent(e,"pop"),this.removeView(),this},showSame:function(b,c){return this.prepareRegion(b,null,c),a.when(this.transition(b,null,c)),this},prepareRegion:function(a,b,c){this.prepareCommonOptions(c),this.prepareRegionContainer(),a&&a.$el&&this.prepareNewView(a,c),b&&b.$el&&this.prepareOldView(b,c)},transition:function(c,d,e){function f(){return c?(i[0]=a.Deferred(),j.transitionIn(c,e).done(function(){i[0].resolve()})):i[0]=!0,d?(i[1]=a.Deferred(),j.transitionOut(d,e).done(function(){i[1].resolve()})):i[1]=!0,a.when.apply(a,i).done(b.bind(function(){h.resolve()},this))}function g(){b.delay(b.bind(f,this),50)}var h=a.Deferred(),i=[],j=this;return b.defer(b.bind(g,this)),h.done(b.bind(function(){this.onComplete(c,d,e)},this))},transitionIn:function(b,c){var d=a.Deferred();return this.enterAnimation(b,c).eventCallback("onComplete",function(){d.resolve()}).play(),d},transitionOut:function(b,c){var d=a.Deferred();return this.exitAnimation(b,c).eventCallback("onComplete",function(){d.resolve()}).play(),d},prepareCommonOptions:function(a){a.distance=this.$el.width()+30,a.duration=a.distance<600?.4:.5},prepareRegionContainer:function(){},prepareNewView:function(a,c){var e={};a.$el.addClass("mt-view"),"backward"===c.direction||c.pop?b.extend(e,{x:"-80"}):b.extend(e,{x:c.distance}),d.set(a.$el,e)},prepareOldView:function(a,c){var e={};a.$el.addClass("mt-view"),("backward"===c.direction||c.pop)&&b.extend(e,{"z-index":"2"}),d.set(a.$el,e)},addViewToDom:function(a){this.$el.append(a.el)},enterAnimation:function(a,c){return b.isFunction(c.enterAnimation)?b.bind(c.enterAnimation(),this)():f(a.$el,0,c)},exitAnimation:function(a,c){return b.isFunction(c.exitAnimation)?b.bind(c.exitAnimation(),this)():c.pop||"backward"===c.direction?f(a.$el,c.distance,c):f(a.$el,-80,b.extend(c,{opacity:"0"}))},addView:function(a){this.viewStack.push(a),this.currentViewIndex++},removeView:function(a){a=a||this.viewStack.length-1,this.viewStack.splice(a,1),this.currentViewIndex--},onComplete:function(a,c,d){a&&(this.attachView(a),this._triggerViewEvent(a,"transition:end"),this._triggerViewEvent(a,"transition:end:in")),c&&(this._triggerViewEvent(c,"transition:end"),this._triggerViewEvent(c,"transition:end:out"),this.preventClose||c.close()),b.isFunction(d.onComplete)&&d.onComplete()},setupTransitionOptions:function(a){var c=b.clone(a)||{};return b.defaults(c,{direction:"forward",enterAnimation:null,exitAnimation:null,onStart:null,onComplete:null,transtionWhenEmpty:!1}),c},_cleanUpOldViews:function(){b.each(this.viewStack,function(a){a.close()})},_resetViews:function(a){this.viewStack=[a],this.currentViewIndex=0},_triggerRepaint:function(){return this.$el.get(0).offsetHeight},_triggerViewEvent:function(a,d){c.triggerMethod.call(this,d,a),b.isFunction(a.triggerMethod)?a.triggerMethod(d):c.triggerMethod.call(a,d)},_show:function(){var a=1<=arguments.length?[].slice.call(arguments,0):[];return c.Region.prototype.show.apply(this,a)},_close:function(){var a=1<=arguments.length?[].slice.call(arguments,0):[];return c.Region.prototype.close.apply(this,a)}});return g}(a,b,c,d,e,f);return g});